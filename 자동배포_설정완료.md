# ✅ GitHub → GCP 자동 배포 설정 완료!

## 🎉 축하합니다!

GitHub에서 GCP 서버(104.154.212.61)로 자동 배포되도록 모든 파일이 준비되었습니다!

---

## 📦 생성된 파일 목록

### 1. `.github/workflows/deploy.yml`
- **역할**: GitHub Actions 자동 배포 워크플로우
- **기능**: main 브랜치에 푸시할 때마다 자동으로 GCP 서버에 배포
- **트리거**: `git push origin main` 실행 시 자동 실행

### 2. `GCP_AUTO_DEPLOY.md`
- **역할**: 자동 배포 상세 가이드 문서
- **내용**: 
  - 초기 설정 방법
  - GitHub Secrets 설정
  - 문제 해결 방법
  - 팀원 사용법

### 3. `QUICKSTART_AUTODEPLOY.md`
- **역할**: 팀원용 빠른 시작 가이드
- **내용**:
  - 간단한 사용법
  - FAQ
  - 베스트 프랙티스
  - 긴급 상황 대응

### 4. `setup_gcp.sh`
- **역할**: GCP 서버 초기 설정 자동화 스크립트
- **기능**: Docker, Git 설치, 프로젝트 클론 등 자동 실행

### 5. `README.md` (업데이트)
- **추가 내용**: GCP 자동 배포 섹션 추가

---

## 🚀 다음 단계 (필수!)

자동 배포를 작동시키려면 다음 3가지 설정이 필요합니다:

### ✅ 1단계: GCP VM 서버 설정

GCP VM에 SSH로 접속:
```bash
gcloud compute ssh your-instance-name --zone=your-zone
# 또는
ssh your-username@104.154.212.61
```

자동 설정 스크립트 실행:
```bash
cd /tmp
# 파일을 직접 업로드하거나 아래 명령 실행
curl -O https://raw.githubusercontent.com/YOUR-USERNAME/YOUR-REPO/main/setup_gcp.sh
chmod +x setup_gcp.sh
./setup_gcp.sh
```

또는 수동 설정:
```bash
# 패키지 설치
sudo apt update
sudo apt install -y docker.io docker-compose git

# Docker 시작
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER

# 로그아웃 후 다시 로그인
exit
```

다시 접속 후 프로젝트 클론:
```bash
cd /home
sudo git clone https://github.com/nogeonu/lung-cancer-prediction-system.git lung-cancer-app
sudo chown -R $USER:$USER /home/lung-cancer-app
```

### ✅ 2단계: SSH 키 생성 및 등록

#### GCP VM에서:
```bash
# SSH 키 생성 (이미 있으면 생략)
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"
# 엔터 3번 (기본 경로, 비밀번호 없음)

# 공개키를 authorized_keys에 추가
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh

# 개인키 내용 출력 (복사해두기)
cat ~/.ssh/id_rsa
```

**출력된 개인키 전체를 복사합니다** (-----BEGIN ... END----- 모두 포함)

### ✅ 3단계: GitHub Secrets 설정

1. GitHub 저장소 페이지로 이동
2. **Settings** 클릭
3. 왼쪽 메뉴에서 **Secrets and variables** → **Actions** 클릭
4. **New repository secret** 버튼 클릭

다음 3개의 Secret을 추가:

#### Secret 1: `GCP_HOST`
```
Name: GCP_HOST
Value: 104.154.212.61
```

#### Secret 2: `GCP_USERNAME`
GCP VM에서 사용자명 확인:
```bash
whoami
```
나온 결과를 입력:
```
Name: GCP_USERNAME
Value: (whoami 명령 결과)
```

#### Secret 3: `GCP_SSH_KEY`
위에서 복사한 SSH 개인키 전체를 붙여넣기:
```
Name: GCP_SSH_KEY
Value: (복사한 개인키 전체 내용)
```

**중요**: 개인키는 다음과 같이 시작하고 끝나야 합니다:
```
-----BEGIN OPENSSH PRIVATE KEY-----
...
-----END OPENSSH PRIVATE KEY-----
```

### ✅ 4단계: GCP 방화벽 설정

포트 8000 열기:

#### 방법 1: gcloud 명령어 (로컬에서)
```bash
gcloud compute firewall-rules create allow-django-app \
    --allow tcp:8000 \
    --source-ranges 0.0.0.0/0 \
    --description "Allow Django app on port 8000"
```

#### 방법 2: GCP 콘솔 (웹 브라우저에서)
1. GCP Console → **VPC 네트워크** → **방화벽 규칙**
2. **방화벽 규칙 만들기** 클릭
3. 설정:
   - 이름: `allow-django-app`
   - 대상: 네트워크의 모든 인스턴스
   - 소스 IP 범위: `0.0.0.0/0`
   - 프로토콜 및 포트: **tcp:8000** 체크
4. **만들기** 클릭

---

## 🎯 자동 배포 테스트

모든 설정이 완료되면 테스트해봅시다!

### 1. 파일들을 GitHub에 푸시
```bash
cd "/Users/nogeon-u/Desktop/건양대_바이오메디컬 /Django/Django_project"

# 변경사항 추가
git add .
git commit -m "GitHub Actions 자동 배포 설정 완료"
git push origin main
```

### 2. GitHub Actions 확인
1. GitHub 저장소 페이지로 이동
2. **Actions** 탭 클릭
3. 새로운 워크플로우 실행 확인
4. 진행 상황을 실시간으로 볼 수 있습니다

### 3. 배포 완료 대기 (3-5분)
- ✅ 녹색 체크마크: 배포 성공!
- ❌ 빨간색 X: 배포 실패 (로그 확인 필요)

### 4. 웹사이트 접속
```
http://104.154.212.61:8000
```

---

## 👥 팀원들에게 알려주세요!

팀원들에게 다음 내용을 공유하세요:

### 📢 간단한 사용법

```bash
# 1. 코드 수정
git add .
git commit -m "기능 추가"

# 2. 푸시 (자동 배포 시작!)
git push origin main

# 3. 3-5분 후 http://104.154.212.61:8000 에서 확인
```

### 📚 자세한 가이드
- **간단 가이드**: `QUICKSTART_AUTODEPLOY.md`
- **상세 가이드**: `GCP_AUTO_DEPLOY.md`

---

## 🔍 문제 해결

### 문제 1: GitHub Actions가 실행되지 않아요
- **원인**: Secrets 설정이 안 됨
- **해결**: GitHub Secrets 다시 확인

### 문제 2: SSH 연결 오류
- **원인**: SSH 키 설정 오류
- **해결**: 
  ```bash
  # GCP VM에서
  cat ~/.ssh/authorized_keys  # 공개키 확인
  ls -la ~/.ssh/              # 권한 확인
  ```

### 문제 3: Docker 오류
- **원인**: Docker가 설치되지 않음
- **해결**:
  ```bash
  # GCP VM에서
  sudo apt install -y docker.io docker-compose
  sudo systemctl start docker
  ```

### 문제 4: 웹사이트가 열리지 않아요
- **원인**: 방화벽 설정 누락
- **해결**: 포트 8000 방화벽 규칙 다시 확인

---

## 📊 배포 프로세스 모니터링

### GitHub에서 확인
```
GitHub 저장소 → Actions 탭 → 워크플로우 클릭
```

### GCP 서버에서 확인
```bash
# SSH 접속
ssh your-username@104.154.212.61

# 컨테이너 상태
cd /home/lung-cancer-app
docker-compose ps

# 실시간 로그
docker-compose logs -f web
```

---

## 🎓 추가 정보

### 자동 배포 흐름도
```
개발자가 코드 수정
    ↓
git add . && git commit -m "..."
    ↓
git push origin main
    ↓
GitHub Actions 트리거
    ↓
GCP VM에 SSH 접속
    ↓
git pull (최신 코드 다운)
    ↓
docker-compose down (기존 컨테이너 중지)
    ↓
docker-compose build (새 이미지 빌드)
    ↓
docker-compose up -d (컨테이너 시작)
    ↓
✅ 배포 완료!
    ↓
http://104.154.212.61:8000 접속 가능
```

### 파일 역할 정리
```
.github/workflows/deploy.yml   → GitHub Actions 워크플로우
docker-compose.yml             → Docker 서비스 정의
Dockerfile                     → Docker 이미지 빌드 설정
deploy.sh                      → 수동 배포 스크립트
GCP_SETUP_GUIDE.md            → 기존 GCP 가이드
GCP_AUTO_DEPLOY.md            → 새로운 자동 배포 가이드
QUICKSTART_AUTODEPLOY.md      → 팀원용 빠른 가이드
setup_gcp.sh                  → GCP 서버 자동 설정 스크립트
```

---

## ✅ 체크리스트

설정 완료 확인:

- [ ] GCP VM에 Docker 설치됨
- [ ] GCP VM에 프로젝트 클론됨 (`/home/lung-cancer-app`)
- [ ] SSH 키 생성 및 등록 완료
- [ ] GitHub Secrets 3개 모두 등록 (GCP_HOST, GCP_USERNAME, GCP_SSH_KEY)
- [ ] GCP 방화벽에서 포트 8000 열림
- [ ] GitHub에 파일들 푸시됨
- [ ] GitHub Actions 실행 확인
- [ ] http://104.154.212.61:8000 접속 가능

---

## 🎉 완료!

이제 팀원들과 함께 실시간으로 협업하면서 자동으로 배포되는 시스템을 사용할 수 있습니다!

코드를 수정하고 푸시만 하면 몇 분 안에 외부 IP 주소에서 변경사항을 확인할 수 있습니다.

**Happy Coding! 🚀**

---

## 📞 도움이 필요하면

- GitHub Issues에 문제 등록
- GCP_AUTO_DEPLOY.md 문서 참고
- 관리자에게 문의

**© 2025 건양대학교 바이오메디컬공학과**

