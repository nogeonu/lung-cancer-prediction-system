{% extends 'lungcancer/base.html' %}

{% block title %}환자 목록 - 폐암 예측 시스템{% endblock %}

{% block content %}
<div class="text-center mb-4">
    <h2 class="fw-bold">
        <i class="bi bi-people text-primary"></i> 환자 목록
    </h2>
    <p class="text-muted">등록된 환자 정보를 관리합니다</p>
</div>

<div class="mb-3 text-end">
    <a href="{% url 'lungcancer:predict' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> 새 환자 등록
    </a>
</div>

{% if patients %}
    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="table-light">
                <tr class="text-center">
                    <th>ID</th>
                    <th>성별</th>
                    <th>나이</th>
                    <th>예측 결과</th>
                    <th>위험도</th>
                    <th>등록일</th>
                    <th>관리</th>
                </tr>
            </thead>
            <tbody>
                {% for patient in patients %}
                <tr class="text-center align-middle">
                    <td><strong>#{{ patient.id }}</strong></td>
                    <td>
                        {% if patient.gender == 1 %}
                            <span class="badge bg-primary">남성</span>
                        {% else %}
                            <span class="badge bg-info">여성</span>
                        {% endif %}
                    </td>
                    <td>{{ patient.age }}세</td>
                    <td>
                        {% if patient.prediction == 'YES' %}
                            <span class="badge bg-danger">
                                <i class="bi bi-exclamation-triangle"></i> 양성
                            </span>
                        {% elif patient.prediction == 'NO' %}
                            <span class="badge bg-success">
                                <i class="bi bi-check-circle"></i> 음성
                            </span>
                        {% else %}
                            <span class="badge bg-secondary">예측 전</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if patient.prediction_probability %}
                            <div class="progress" style="height: 20px; min-width: 100px;">
                                {% widthratio patient.prediction_probability 1 100 as percentage %}
                                <div class="progress-bar 
                                    {% if patient.prediction == 'YES' %}bg-danger{% else %}bg-success{% endif %}"
                                    style="width: {{ percentage }}%">
                                    {{ percentage }}%
                                </div>
                            </div>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>{{ patient.created_at|date:"Y.m.d H:i" }}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <a href="{% url 'lungcancer:patient_detail' patient.id %}" 
                               class="btn btn-sm btn-outline-info" title="상세보기">
                                <i class="bi bi-eye"></i>
                            </a>
                            <a href="{% url 'lungcancer:patient_update' patient.id %}" 
                               class="btn btn-sm btn-outline-warning" title="수정">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{% url 'lungcancer:patient_delete' patient.id %}" 
                               class="btn btn-sm btn-outline-danger" title="삭제">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="alert alert-warning text-center">
        <i class="bi bi-exclamation-circle"></i>
        등록된 환자가 없습니다. 
        <a href="{% url 'lungcancer:predict' %}" class="alert-link">새 환자를 등록</a>하세요.
    </div>
{% endif %}
{% endblock %}

